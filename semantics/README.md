# Using Semantic UCCA Transitions with Nematus
The files in this directory are used to run Nematus using semantic transition generated by TUPA.

## How to Run
1. Follow the instructions [in the TUPA package](https://github.com/danielhers/tupa#pre-trained-models-with-bert)
to get the pre-trained bert model.
2. Make sure you have the requirements in requirements.txt and requirements.bert.txt.  
You may want to run `pip install -r requirements.txt` and `pip install -r requirements.bert.txt`
3. Setup the running scripts:
    * To run full training - change the parameters in the `scripts/generate_semantics_and_train.sh` script, under "Setup path and data Variables".    
    Make sure you have the validation files ready (you would need to generate the semantic transitions for them).  
    If there is an existing transitions file, the script will not overwrite it and skip the file creation.
    * To only generate the transitions file - change the parameters in the `scripts/generate_semantics.sh` script.  
4. Run the modified `scripts/generate_semantics_and_train.sh` script.

## Special points of interest in code.
* Most future changes to this should be done in the `convert_semantic_transitions_text_to_graph()` function, under `nematus/data_iterator.py`, and where this function is called.  
* Another point of interest is the FileWrapper class in data_iterator.py, which was changed to consume a lines file indicating which lines should be processed.
* Lastly, the `semantics/semantic_transition_parsing.py` file converts the TUPA output files to a transition pasrsing format.


## Notes
* The length of the transitions here is long. This means more memory consumption and longer run time. Consider this.
* For the above reason, validation set used was capped to 1000 sentences, and it still takes a long time to validate.
* You can see example of valid input\output files of `scripts/generate_semantics_and_train.sh` and `scripts/generate_semantics.sh` scripts  in the data directory:
    * **newstest2013.unesc.tok.tc.bpe.de** - input source file for nematus.
    * **newstest2013.unesc.tok.tc.en** - contains the raw input file, ucca transitions are generated for it.
    * **newstest2013.unesc.tok.tc.en.ucca_trns** - contains the final ucca transitions file (generated by script).
      This is used as input target file for nematus.
    * newstest2013.unesc.tok.tc.en.txt - raw input file with .txt extension and separating newline between sentences (required format by TUPA).
    * newstest2013.unesc.tok.tc.en.ucca_trns.line_nums - line nums file (generated by script)
    * newstest2013.unesc.tok.tc.en.ucca_trns.json - labels dict file (generated by script)
    * newstest2013.unesc.tok.tc.bpe.en - input bpe file (used when creating transitions file)
    * newstest2013.unesc.tok.tc.en_ucca_res - directory of the graphs generated by TUPA.
   
    